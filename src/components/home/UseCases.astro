---
import { Image } from "astro:assets";
import { ArrowRight, BookOpen, Castle, Rocket, Ticket } from "lucide-react";
import fortImage from "../../assets/fort-build.png";
import { Button } from "../common/Button";
import { Container } from "../common/Container";

interface ActivityItem {
	icon?: string | null;
	label: string;
}

interface FeatureImage {
	url: string;
	alternativeText?: string | null;
}

interface Props {
	title: string;
	subtitle?: string | null;
	activities: ActivityItem[] | null;
	ctaText?: string | null;
	ctaLink?: string | null;
	image?: FeatureImage | null;
}

const {
	title,
	subtitle,
	activities,
	ctaText = "Explore More Combinations",
	ctaLink = "/tinyverse",
	image,
} = Astro.props;

const getIcon = (iconName: string | null | undefined, label: string) => {
	const key = (iconName || label).toLowerCase();

	if (key.includes("castle") || key.includes("fort")) return Castle;
	if (key.includes("rocket") || key.includes("launch")) return Rocket;
	if (key.includes("book") || key.includes("reading")) return BookOpen;
	if (key.includes("ticket") || key.includes("obstacle")) return Ticket;

	return Castle; // Default
};
---

<section class="py-20 overflow-hidden">
  <Container>
    <div class="flex flex-col lg:flex-row items-center gap-12 lg:gap-20">
      {/* Content Side */}
      <div class="flex-1 space-y-8">
        <div class="space-y-4">
          <h2
            class="text-4xl lg:text-5xl font-bold font-heading text-primary leading-tight"
          >
            {title}
          </h2>
          {
            subtitle && (
              <p class="text-xl text-text-muted leading-relaxed">{subtitle}</p>
            )
          }
        </div>

        {
          activities && (
            <div class="grid grid-cols-2 gap-4">
              {activities.map((activity) => {
                const IconComponent = getIcon(activity.icon, activity.label);
                return (
                  <div class="flex items-center gap-3 text-lg font-medium text-text-main">
                    <IconComponent className="text-primary" />
                    <span>{activity.label}</span>
                  </div>
                );
              })}
            </div>
          )
        }

        <div class="pt-4">
          <a href={ctaLink || "/tinyverse"}>
            <Button variant="outline" size="lg" className="group">
              {ctaText}
              <ArrowRight
                className="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform"
              />
            </Button>
          </a>
        </div>
      </div>

      {/* Image Side */}
      <div class="flex-1 relative">
        <div
          class="absolute -inset-4 bg-secondary/50 rounded-3xl -z-10 rotate-3 transform"
        >
        </div>
        {
          image?.url ? (
            <img
              src={image.url}
              alt={image.alternativeText || "Kids building a fort"}
              class="rounded-2xl shadow-xl w-full h-auto object-cover aspect-[4/3]"
            />
          ) : (
            <Image
              src={fortImage}
              alt="Kids building a fort"
              class="rounded-2xl shadow-xl w-full h-auto object-cover aspect-[4/3]"
            />
          )
        }
        {/* Decorative elements */}
        <div
          class="absolute -bottom-6 -left-6 bg-white p-4 rounded-xl shadow-lg animate-bounce duration-[3000ms]"
        >
          <span class="text-3xl">üè∞</span>
        </div>
        <div
          class="absolute -top-6 -right-6 bg-white p-4 rounded-xl shadow-lg animate-pulse"
        >
          <span class="text-3xl">üöÄ</span>
        </div>
      </div>
    </div>
  </Container>
</section>
