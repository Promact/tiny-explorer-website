---
import { Container } from "../common/Container";
import { Layers, ShieldCheck, Sparkles, Heart } from "lucide-react";

interface FeatureItem {
  icon?: string | null;
  title: string;
  description?: string | null;
}

interface Props {
  title: string;
  subtitle?: string | null;
  features: FeatureItem[] | null;
}

const { title, subtitle, features } = Astro.props;

// Map Strapi icon names or titles to Lucide icons
const getIcon = (iconName: string | null | undefined, featureTitle: string) => {
  // Basic mapping based on keywords or exact matches
  const key = (iconName || featureTitle).toLowerCase();

  if (key.includes("module") || key.includes("layer") || key.includes("ðŸ§©"))
    return Layers;
  if (key.includes("safe") || key.includes("shield") || key.includes("durable"))
    return ShieldCheck;
  if (key.includes("clean") || key.includes("sparkle") || key.includes("â˜ï¸"))
    return Sparkles;
  if (key.includes("soft") || key.includes("comfort") || key.includes("heart"))
    return Heart;

  return Sparkles; // Default
};

// Map colors based on index or random for visual variety
const getColorStyles = (index: number) => {
  const styles = [
    { color: "text-blue-500", bgColor: "bg-blue-50" },
    { color: "text-green-500", bgColor: "bg-green-50" },
    { color: "text-orange-500", bgColor: "bg-orange-50" },
    { color: "text-red-500", bgColor: "bg-red-50" },
  ];
  return styles[index % styles.length];
};
---

<section class="py-20 bg-white">
  <Container>
    <div class="text-center max-w-3xl mx-auto mb-16">
      <h2 class="text-4xl font-bold font-heading text-primary mb-6">{title}</h2>
      {
        subtitle && (
          <p class="text-xl text-text-muted leading-relaxed">{subtitle}</p>
        )
      }
    </div>

    {
      features && (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
          {features.map((feature, index) => {
            const IconComponent = getIcon(feature.icon, feature.title);
            const style = getColorStyles(index);

            return (
              <div class="flex flex-col items-center text-center p-6 rounded-2xl hover:shadow-lg transition-shadow duration-300 border border-gray-100 h-full">
                <div
                  class={`p-4 rounded-full mb-4 ${style.bgColor} ${style.color}`}
                >
                  <IconComponent size={32} />
                </div>
                <h3 class="text-xl font-bold font-heading mb-3 text-text-main">
                  {feature.title}
                </h3>
                <p class="text-text-muted leading-relaxed mb-4 flex-grow">
                  {feature.description}
                </p>
                {/* Media Placeholder matching Spec */}
                <div class="w-full aspect-video bg-gray-100 rounded-lg flex items-center justify-center text-xs text-gray-400 font-mono border border-dashed border-gray-200 mt-auto">
                  {feature.title.includes("Modular") &&
                    "Carousel: Forts/Builds"}
                  {feature.title.includes("Durable") &&
                    "Photo/Video: Materials"}
                  {feature.title.includes("Clean") && "Video: Cleaning Demo"}
                  {feature.title.includes("Comfort") && "Image: Cozy Moments"}
                </div>
              </div>
            );
          })}
        </div>
      )
    }
  </Container>
</section>
